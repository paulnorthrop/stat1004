<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chapter 1: Stochastic Simulation • stat1004</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 1: Stochastic Simulation">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stat1004</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/stat1004-ch1a-shuttle-vignette.html">Chapter 1: The Challenger Space Shuttle Disaster</a>
    </li>
    <li>
      <a href="../articles/stat1004-ch1b-stochastic-simulation-vignette.html">Chapter 1: Stochastic Simulation</a>
    </li>
    <li>
      <a href="../articles/stat1004-ch2a-descriptive-statistics-vignette.html">Chapter 2: Descriptive Statistics</a>
    </li>
    <li>
      <a href="../articles/stat1004-ch2b-graphs-vignette.html">Chapter 2: Graphs (One Variable)</a>
    </li>
    <li>
      <a href="../articles/stat1004-ch2c-graphs-vignette.html">Chapter 2: Graphs (More Than One Variable)</a>
    </li>
    <li>
      <a href="../articles/stat1004-ch2d-box-cox-transformation-vignette.html">Chapter 2: Transformation Of Variable</a>
    </li>
    <li>
      <a href="../articles/stat1004-ch5a-discrete-random-variables-vignette.html">Chapter 5: binomial, geometric and Poisson distributions</a>
    </li>
    <li>
      <a href="../articles/stat1004-ch5b-continous-random-variables-vignette.html">Chapter 5: uniform, exponential and normal distributions</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/paulnorthrop/stat1004">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Chapter 1: Stochastic Simulation</h1>
                        <h4 class="author">Paul Northrop</h4>
            
            <h4 class="date">2019-11-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/paulnorthrop/stat1004/blob/master/vignettes/stat1004-ch1b-stochastic-simulation-vignette.Rmd"><code>vignettes/stat1004-ch1b-stochastic-simulation-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>stat1004-ch1b-stochastic-simulation-vignette.Rmd</code></div>

    </div>

    
    
<p>Stochastic simulation uses computer-generated <em>pseudo-random numbers</em> to mimic a stochastic real event or dataset. Pseudo-random numbers are not random (they are produced by an algorithm) but the algorithm is constructed in order to imitate randomness closely enough. A typical use of stochastic simulation is to generate numbers that behave approximately like a random sample from an particular probability distribution.</p>
<p>In this vignette we concentrate on using R to perform stochastic simulation. For a more general introduction to stochastic simulation, and a more detailed explanation of the ideas underlying the R code, see the short <a href="https://moodle.ucl.ac.uk/course/view.php?id=8579&amp;section=8">Stochastic simulation video</a>. If you want to know more then good sources of information are <span class="citation">Morgan (1984)</span> and <span class="citation">Jasra (2011)</span>.</p>
<p>The R code used in this vignette are available: <a href="stat1004-ch1b-stochastic-simulation-vignette.R">stochastic-simulation-vignette.R</a>. The function <code>rbinomial</code> can be viewed either by typing <code>rbinomial</code> at R command prompt <code><a href="https://rdrr.io/r/base/Comparison.html">&gt;</a></code> or at <a href="https://github.com/paulnorthrop/stat1004/tree/master/R/stochastic_simulation.R">GitHub</a></p>
<div id="pseudo-random-numbers-in-01" class="section level2">
<h2 class="hasAnchor">
<a href="#pseudo-random-numbers-in-01" class="anchor"></a>Pseudo-random numbers in (0,1)</h2>
<p>The basic building block of stochastic simulation methods is the ability to simulate numbers (pseudo-) randomly from the interval (0,1). As we will see in Section 5.5 of the <a href="https://moodle.ucl.ac.uk/course/view.php?id=8579&amp;section=3">STAT0002 notes</a> this is equivalent to generating numbers that behave approximately like a random sample from a standard uniform U(0,1) distribution. The function in R that does this is <code>runif</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(stat1004)
<span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="dv">10</span>)
 [<span class="dv">1</span>] <span class="fl">0.2716465</span> <span class="fl">0.2459657</span> <span class="fl">0.7786462</span> <span class="fl">0.9790115</span> <span class="fl">0.4347586</span> <span class="fl">0.9141322</span> <span class="fl">0.4885213</span>
 [<span class="dv">8</span>] <span class="fl">0.3757858</span> <span class="fl">0.5054086</span> <span class="fl">0.4264149</span></code></pre></div>
</div>
<div id="simulation-from-a-binomial-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-from-a-binomial-distribution" class="anchor"></a>Simulation from a binomial distribution</h2>
<p>In the <a href="stat1004-ch1a-shuttle-vignette.html">Challenger Space Shuttle disaster</a> vignette we needed to simulate numbers from a binomial distribution with parameters <span class="math inline">\(6\)</span> and <span class="math inline">\(p\)</span>, for a given value of <span class="math inline">\(p\)</span>. As we will see in Section 5.3 of the <a href="https://moodle.ucl.ac.uk/course/view.php?id=8579&amp;section=3">STAT0002 notes</a> this distribution arises as the number of ‘successes’ (perversely, in the space shuttle example thermal distress of an O-ring is a ‘success’) in a fixed number (here, this is 6) of independent trials, where each trial results either in a ‘success’ or a ‘failure’.</p>
<p>Suppose that <span class="math inline">\(p=0.2\)</span>, which is the approximate estimated probability (under a linear logistic model) that an O-ring suffers thermal distress when the space shuttle is launched at 58 degrees Fahrenheit.</p>
<p>The function in R that simulates from a binomial distribution is <code>rbinom</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">6</span>, <span class="dt">prob =</span> <span class="fl">0.2</span>)
[<span class="dv">1</span>] <span class="dv">0</span></code></pre></div>
<ol style="list-style-type: decimal">
<li><strong>Can you see the convention in the way that R’s simulation functions are named?</strong></li>
</ol>
<p>Underlying <code>rbinom</code> is an algorithm that works quickly even in cases where the number of trials (<code>size</code>) is large. With a small number of trials, like 6, we could work more directly, using numbers produced by <code>runif</code> to assign the result of each trial to ‘success’ or ‘failure’. This is like tossing a coin that is biased so that ‘heads’ is obtained with probability 0.2. The function <code>rbinomial</code> below simulates <em>one</em> value from a binomial distribution with parameters <code>size</code> and <code>prob</code>. Use <code><a href="../reference/rbinomial.html">?rbinomial</a></code> to view the help file. This function is less general and less efficient than <code>rbinom</code>. However, it is useful to illustrate a simple way to simulate from a binomial distribution and as an example of how we can write our own R functions to perform calculations.</p>
<pre><code>rbinomial &lt;- function(size, prob) {
  # Simulate size values (pseudo-)randomly between 0 and 1.
  u &lt;- runif(size)
  # Find out whether (TRUE) or not (FALSE) each value of u is less than prob.
  distress &lt;- u &lt; prob
  # Count the number of TRUEs, i.e. the number of successes.
  n_successes &lt;- sum(distress)
  # Return the number of successes.
  return(n_successes)
}</code></pre>
<p>We simulate one value from a binomial(6, 0.2) distribution. [We use <code>set.seed</code> to initialize the pseudo-random number sequence in a particular place. This will enable us to repeat these calculations below using exactly the same random numbers.]</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">1826</span>)
<span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="../reference/rbinomial.html">rbinomial</a></span>(<span class="dt">size =</span> <span class="dv">6</span>, <span class="dt">prob =</span> <span class="fl">0.2</span>)
[<span class="dv">1</span>] <span class="dv">1</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><strong>Can you work out what is happening in each line of the code inside <code>rbinomial</code>? The following should help.</strong></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">1826</span>)
<span class="op">&gt;</span><span class="st"> </span>size &lt;-<span class="st"> </span><span class="dv">6</span>
<span class="op">&gt;</span><span class="st"> </span>prob &lt;-<span class="st"> </span><span class="fl">0.2</span>
<span class="op">&gt;</span><span class="st"> </span>u &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(size)
<span class="op">&gt;</span><span class="st"> </span>u
[<span class="dv">1</span>] <span class="fl">0.3561567</span> <span class="fl">0.9131876</span> <span class="fl">0.5627795</span> <span class="fl">0.1879185</span> <span class="fl">0.3193222</span> <span class="fl">0.6738423</span>
<span class="op">&gt;</span><span class="st"> </span>distress &lt;-<span class="st"> </span>u <span class="op">&lt;</span><span class="st"> </span>prob
<span class="op">&gt;</span><span class="st"> </span>distress
[<span class="dv">1</span>] <span class="ot">FALSE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span>  <span class="ot">TRUE</span> <span class="ot">FALSE</span> <span class="ot">FALSE</span>
<span class="op">&gt;</span><span class="st"> </span>n_successes &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(distress)
<span class="op">&gt;</span><span class="st"> </span>n_successes
[<span class="dv">1</span>] <span class="dv">1</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><strong>The effect of <code><a href="https://rdrr.io/r/base/sum.html">sum(distress)</a></code> is quite subtle. Can you see what is happening? Check your answer using <code><a href="https://rdrr.io/r/base/sum.html">?sum</a></code>.</strong></li>
</ol>
<p>A related point is that is we turn the logical vector <code>distress</code> (which contains <code>TRUE</code>s and <code>FALSE</code>s) into a numeric vector, then we get …</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(distress)
[<span class="dv">1</span>] <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span></code></pre></div>
</div>
<div id="simulation-from-a-exponential-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-from-a-exponential-distribution" class="anchor"></a>Simulation from a exponential distribution</h2>
<p>The exponential distribution (see Section 5.6 of the <a href="https://moodle.ucl.ac.uk/course/view.php?id=8579&amp;section=3">STAT0002 notes</a> is an example of a probability distribution of a continuous random variable (see Section 4.2 of the <a href="https://moodle.ucl.ac.uk/course/view.php?id=8579&amp;section=3">STAT0002 notes</a>).</p>
<ol start="4" style="list-style-type: decimal">
<li><strong>Can you guess the name of the R function for simulating from an exponential distribution?</strong></li>
</ol>
<p>We simulate a sample of size 1000 from an exponential distribution with (rate) parameter equal to 2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>lambda &lt;-<span class="st"> </span><span class="dv">2</span>
<span class="op">&gt;</span><span class="st"> </span>exp_sim &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span>(<span class="dt">n =</span> <span class="dv">1000</span>, <span class="dt">rate =</span> lambda)</code></pre></div>
<p>We produce a histogram of these simulated values (see Section 2.5 of the <a href="https://moodle.ucl.ac.uk/course/view.php?id=8579&amp;section=3">STAT0002 notes</a>) and superimpose the probability density function (p.d.f.) of the exponential distribution from which these values have been simulated.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="co"># A histogram (see Section 2.5 of the STAT0002 notes)</span>
<span class="er">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(exp_sim, <span class="dt">probability =</span> <span class="ot">TRUE</span>, <span class="dt">ylim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, lambda), <span class="dt">main =</span> <span class="st">""</span>)
<span class="op">&gt;</span><span class="st"> </span>x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>, <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(exp_sim), <span class="dt">len =</span> <span class="dv">500</span>)
<span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(x, <span class="kw"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span>(x, <span class="dt">rate =</span> lambda))</code></pre></div>
<p><img src="stat1004-ch1b-stochastic-simulation-vignette_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
<ol start="5" style="list-style-type: decimal">
<li><strong>Can you guess what the function <code>dexp</code> does? Use <code><a href="https://rdrr.io/r/stats/Exponential.html">?dexp</a></code> to find out.</strong></li>
</ol>
<p>After you have answered Question 5 of the <a href="https://moodle.ucl.ac.uk/mod/quiz/view.php?id=316126">Quiz for Exercises 6</a> you will see why the following R code could be used to simulate from an exponential distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>u &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="dv">1000</span>)
<span class="op">&gt;</span><span class="st"> </span>exp_inv &lt;-<span class="st"> </span><span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(u)<span class="op">/</span>lambda
<span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(exp_inv, <span class="dt">probability =</span> <span class="ot">TRUE</span>, <span class="dt">ylim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, lambda), <span class="dt">main =</span> <span class="st">""</span>, <span class="dt">breaks =</span> <span class="dv">14</span>, <span class="dt">col =</span> <span class="st">"grey"</span>)
<span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(x, <span class="kw"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span>(x, <span class="dt">rate =</span> lambda))</code></pre></div>
<p><img src="stat1004-ch1b-stochastic-simulation-vignette_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
</div>
<div id="the-inversion-method" class="section level2">
<h2 class="hasAnchor">
<a href="#the-inversion-method" class="anchor"></a>The inversion method</h2>
<p>The code immediately above is an example of the <em>inversion method</em> of simulation. See the <a href="https://moodle.ucl.ac.uk/course/view.php?id=8579&amp;section=8">Stochastic simulation video</a> for some detail. The following code implements this for the normal distribution (see Section 5.7 of the <a href="https://moodle.ucl.ac.uk/course/view.php?id=8579&amp;section=3">STAT0002 notes</a>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>u &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="dv">1000</span>)
<span class="op">&gt;</span><span class="st"> </span>mu &lt;-<span class="st"> </span><span class="dv">0</span>
<span class="op">&gt;</span><span class="st"> </span>sigma &lt;-<span class="st"> </span><span class="dv">1</span>
<span class="op">&gt;</span><span class="st"> </span>norm_sim &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span>(u, <span class="dt">mean =</span> mu, <span class="dt">sd =</span> sigma)
<span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(norm_sim, <span class="dt">probability =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">""</span>, <span class="dt">col =</span> <span class="st">"grey"</span>)
<span class="op">&gt;</span><span class="st"> </span>x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(norm_sim), <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(norm_sim), <span class="dt">len =</span> <span class="dv">500</span>)
<span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(x, <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(x, <span class="dt">mean =</span> mu, <span class="dt">sd =</span> sigma))</code></pre></div>
<p><img src="stat1004-ch1b-stochastic-simulation-vignette_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
<ol start="6" style="list-style-type: decimal">
<li><strong>Use <code><a href="https://rdrr.io/r/stats/Normal.html">?qnorm</a></code> to find out what <code>qnorm</code> does.</strong></li>
</ol>
<p>Note that the help page calls this the <em>quantile function</em>. An alternative name is the <em>inverse cumulative distribution function</em> or <em>inverse c.d.f</em> (see Section 5.7 of the <a href="https://moodle.ucl.ac.uk/course/view.php?id=8579&amp;section=3">STAT0002 notes</a>).</p>
</div>
<div id="more-general-methods-of-simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#more-general-methods-of-simulation" class="anchor"></a>More general methods of simulation</h2>
<p>Often the most efficient method of simulating values from a probability distribution is one that has been devised for that particular distribution. However, it is useful to have more general methods that can, in principle, be used to simulate from any distribution, although, in practice, there are constraints on the type of distribution to which a method can be applied. Many of these methods work by proposing values and then accepting or rejecting them using a rule (hence they are often called <em>acceptance-rejection</em> or <em>rejection</em> methods). See <span class="citation">Morgan (1984)</span> and <span class="citation">Jasra (2011)</span> for details. One such method is the <em>generalized ratio-of-uniforms</em> method (<span class="citation">Wakefield, Gelfand, and Smith (1991)</span> and references therein), which can be used for univariate distributions (involving one random variable) and for multivariate distributions (involving two or more random variables), provided that the p.d.f. of the distributions satisfies some conditions.</p>
<p>The <em>rust</em> R package <span class="citation">(Northrop 2017)</span> implements this algorithm. The code below can be used to simulate from a standard normal distribution using the function <code>ru</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rust)
<span class="op">&gt;</span><span class="st"> </span>?ru
<span class="op">&gt;</span><span class="st"> </span><span class="co"># Simulate from a standard normal N(0,1) distribution</span>
<span class="er">&gt;</span><span class="st"> </span>ru_sim &lt;-<span class="st"> </span><span class="kw">ru</span>(<span class="dt">logf =</span> <span class="cf">function</span>(x) <span class="op">-</span>x <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">d =</span> <span class="dv">1</span>, <span class="dt">n =</span> <span class="dv">1000</span>, <span class="dt">init =</span> <span class="fl">0.1</span>)
<span class="op">&gt;</span><span class="st"> </span><span class="co"># The function ru returns an object of class "ru"</span>
<span class="er">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(ru_sim)
[<span class="dv">1</span>] <span class="st">"ru"</span>
<span class="op">&gt;</span><span class="st"> </span><span class="co"># The default plot method for objects of class "ru" produces a plot to compare the </span>
<span class="er">&gt;</span><span class="st"> </span><span class="co"># simulated values and the p.d.f. of the distribution from which they are simulated</span>
<span class="er">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(ru_sim, <span class="dt">xlab =</span> <span class="st">"x"</span>)</code></pre></div>
<p><img src="stat1004-ch1b-stochastic-simulation-vignette_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
<p>Note that</p>
<ul>
<li>the main input to this function is the (natural) log of the p.d.f of a standard normal distribution, i.e. the log of <span class="math inline">\(\frac{1}{\sqrt{2\pi}} e^{-\frac12 x^2}\)</span>;<br>
</li>
<li>we don’t need to include the normalizing constant <span class="math inline">\(1/\sqrt{2\pi}\)</span>, that is, the constant that is included to ensure that the p.d.f. integrates to 1 over the support <span class="math inline">\(-\infty &lt; x &lt; \infty\)</span> of this distribution.</li>
</ul>
<p>The second point, a typical feature of <em>rejection</em> methods, can be important because there are cases where we can’t easily calculate the normalizing constant.</p>
<p>We the use of <code>ru</code> to simulate from a multivariate distribution using the bivariate normal distribution. This distribution will be studied in the second-year statistics module STAT0005. See the Wikipedia page for the <a href="https://en.wikipedia.org/wiki/Multivariate_normal_distribution#Non-degenerate_case">multivariate normal distribution</a> for the form of the p.d.f. of this distribution. The function <code>log_dmvnorm</code> below calculates the log of the p.d.f. of the multivariate normal distribution with mean vector <code>mean</code> and variance-covariance matrix <code>sigma</code>, again ignoring the normalizing constant.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="co"># two-dimensional normal with positive association ----------------</span>
<span class="er">&gt;</span><span class="st"> </span>rho &lt;-<span class="st"> </span><span class="fl">0.9</span>
<span class="op">&gt;</span><span class="st"> </span>covmat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, rho, rho, <span class="dv">1</span>), <span class="dv">2</span>, <span class="dv">2</span>)
<span class="op">&gt;</span><span class="st"> </span>log_dmvnorm &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">mean =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">0</span>, d), <span class="dt">sigma =</span> <span class="kw"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(d)) {
<span class="op">+</span><span class="st">   </span>x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(x, <span class="dt">ncol =</span> <span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(x))
<span class="op">+</span><span class="st">   </span>d &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(x)
<span class="op">+</span><span class="st">   </span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="op">-</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span>(x <span class="op">-</span><span class="st"> </span>mean) <span class="op">%*%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/solve.html">solve</a></span>(sigma) <span class="op">%*%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(x <span class="op">-</span><span class="st"> </span>mean))
<span class="op">+</span><span class="st"> </span>}
<span class="op">&gt;</span><span class="st"> </span>ru_sim2 &lt;-<span class="st"> </span><span class="kw">ru</span>(<span class="dt">logf =</span> log_dmvnorm, <span class="dt">sigma =</span> covmat, <span class="dt">d =</span> <span class="dv">2</span>, <span class="dt">n =</span> <span class="dv">1000</span>, <span class="dt">init =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>))</code></pre></div>
<p>In the bivariate case the <code>plot</code> method for objects of class “ru” produces a scatter plot of the simulated values of the random variables <span class="math inline">\((X_1, X_2)\)</span> with the contours of the value of the p.d.f. superimposed. Each contour is labelled by a number indicating the percentage of the simulated values that should lie within that contour.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(ru_sim2, <span class="dt">xlab =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(X[<span class="dv">1</span>]), <span class="dt">ylab =</span> <span class="kw"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(X[<span class="dv">2</span>]))</code></pre></div>
<p><img src="stat1004-ch1b-stochastic-simulation-vignette_files/figure-html/unnamed-chunk-14-1.png" width="576"></p>
<p>The generalized ratio-of-uniforms method works well enough for this example but it is not the most efficient way to simulate from a multivariate normal distribution. A better function is the <code>mvrnorm</code> in the MASS package <span class="citation">(Venables and Ripley 2002)</span>. Use <code><a href="https://rdrr.io/r/base/library.html">library(MASS)</a></code> and <code>?mvrnorm</code> to find out about it.</p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({  "HTML-CSS": { minScaleAdjust: 125, availableFonts: [] }  });
</script><div id="refs" class="references">
<div id="ref-Jasra">
<p>Jasra, A. 2011. <em>M3/M4s9 Stochastic Simulation (Course Notes)</em>. Imperial College, London. <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.188.5510&amp;rep=rep1&amp;type=pdf" class="uri">http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.188.5510&amp;rep=rep1&amp;type=pdf</a>.</p>
</div>
<div id="ref-Morgan">
<p>Morgan, B. J. T. 1984. <em>Elements of Simulation</em>. Chapman &amp; Hall. <a href="https://www.crcpress.com/Elements-of-Simulation/Morgan/p/book/9780412245909" class="uri">https://www.crcpress.com/Elements-of-Simulation/Morgan/p/book/9780412245909</a>.</p>
</div>
<div id="ref-rust">
<p>Northrop, P. J. 2017. <em>Rust: Ratio-of-Uniforms Simulation with Transformation</em>. <a href="https://CRAN.R-project.org/package=rust" class="uri">https://CRAN.R-project.org/package=rust</a>.</p>
</div>
<div id="ref-MASS">
<p>Venables, W. N., and B. D. Ripley. 2002. <em>Modern Applied Statistics with S</em>. Fourth. New York: Springer. <a href="http://www.stats.ox.ac.uk/pub/MASS4" class="uri">http://www.stats.ox.ac.uk/pub/MASS4</a>.</p>
</div>
<div id="ref-WGS1991">
<p>Wakefield, J. C., A. E. Gelfand, and A. F. M. Smith. 1991. “Efficient Generation of Random Variates via the Ratio-of-Uniforms Method.” <em>Statistics and Computing</em> 1 (2): 129–33. doi:<a href="https://doi.org/10.1007/BF01889987">10.1007/BF01889987</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#pseudo-random-numbers-in-01">Pseudo-random numbers in (0,1)</a></li>
      <li><a href="#simulation-from-a-binomial-distribution">Simulation from a binomial distribution</a></li>
      <li><a href="#simulation-from-a-exponential-distribution">Simulation from a exponential distribution</a></li>
      <li><a href="#the-inversion-method">The inversion method</a></li>
      <li><a href="#more-general-methods-of-simulation">More general methods of simulation</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Paul J. Northrop.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
